/*!
 *   jandent.js
 * See {@link https://github.com/dettalant/jandent}
 *
 * @author dettalant
 * @version v0.1.0
 * @license MIT License
 */
class e{constructor(e){this.message=e,this.name="JandentError"}toString(){return this.name+": "+this.message}}
/*!
 *   convert_arabic_num.js
 * See {@link https://github.com/dettalant/convert_arabic_num}
 *
 * @author dettalant
 * @version v0.1.0
 * @license MIT License
 */class t{constructor(e){this.mode="simple",this.charMode="modern",void 0!==e&&(void 0!==e.mode&&(this.mode=e.mode),void 0!==e.charMode&&(this.charMode=e.charMode))}convert(e){const t=/((?:[\d]+[\.,]?)+)/g,s=e.split(t);let i="";for(let e of s){t.test(e)?(e=this.removeComma(e),i+=e="verbose"===this.mode?this.convert_verbose(e):"moderate"===this.mode?this.convert_moderate(e):this.convert_simple(e)):i+=e}return i}convert_simple(e){const t="retro"===this.charMode?this.retroCharMap:this.modernCharMap;for(let[s,i]of t){const t=new RegExp("["+("."===s?".":s)+"]","g");e=e.replace(t,i)}return e}convert_verbose(e){const t=e.split(".");let s="";const i=Array.from(t[0]),r=i.length,n=this.moderateUnitsArray,c=n.length,a=this.verboseUnitsArray,o=a.length;for(let e=0;e<r;e++){let t=i[r-1-e];if("0"===t)continue;const h=e%o,l=a[h],p=0!==e&&0===h?n[Math.floor((e-4)/4)%c]:"";"1"===t&&0!==e&&""===p&&(t=""),s=t+l+p+s}return t.length>1&&(s+="・"+t[1]),this.convert_simple(s)}convert_moderate(e){const t=e.split(".");let s="";const i=t[0],r=i.length;if(r<=4)s+=this.convert_simple(i);else{const t=Math.ceil(r/4);let i=r;const n=this.moderateUnitsArray,c=n.length;for(let r=0;r<t;r++){const t=4,a=i>t?i-t:0,o=0!==r?n[(r-1)%c]:"";s=e.slice(a,i)+o+s,i-=t}}if(t.length>1){s+="・"+t[1]}return this.convert_simple(s)}get modernCharMap(){return new Map([["1","一"],["2","二"],["3","三"],["4","四"],["5","五"],["6","六"],["7","七"],["8","八"],["9","九"],["0","〇"],[".","・"]])}get retroCharMap(){return new Map([["1","壱"],["2","弐"],["3","参"],["4","肆"],["5","伍"],["6","陸"],["7","漆"],["8","捌"],["9","玖"],["0","零"],[".","・"],["十","拾"],["百","佰"],["千","仟"],["万","萬"]])}get verboseUnitsArray(){return["","十","百","千"]}get moderateUnitsArray(){return["万","億","兆","京","垓","𥝱","穣","溝","正","載","極","恒河沙","阿僧祇","那由他","不可思議","無量大数"]}removeComma(e){return e.replace(/[,]/g,"")}}class s{constructor(e){this.convertArabicNum=new t,this.states={isLint:!1,lineNumber:1};const s={options:this.defaultJandentOptions,chars:this.defaultTargetChars};void 0!==e&&(void 0!==e.options&&Object.assign(s.options,e.options),void 0!==e.chars&&Object.assign(s.chars,e.chars));const i=this.getOptionsHandler();this.options=new Proxy(s.options,i),this.chars=s.chars,this.options.isConvertHarfExclam&&this.appendHarfExclamReplaceSetting(),this.options.isConvertArabicNum&&this.appendFullNumeralReplaceSetting()}run(e){const t=this.lint(e);return[this.convert(e),t]}convert(t){this.states=this.defaultJandentStates;const s=this.process(t);if(!this.isConvertResult(s))throw new e("convert()関数の返り値がJandentConvertResultでない");return s}lint(t){this.states=this.defaultJandentStates,this.states.isLint=!0;const s=this.process(t);if(!this.isLintResult(s))throw new e("lint()関数の返り値がJandentLintResultでない");return s}process(e){const t=this.isLint?"lint":"convert",s=this.isLint?this.lintProcess(e):this.convertProcess(e);return this.states=this.defaultJandentStates,{type:t,some:s}}convertProcess(e){const t=e.split(/\n|\r|\r\n/);let s="";for(let e of t)s+=this.lineConvert(e)+this.chars.newline;return s}lintProcess(e){const t=e.split(/\n|\r|\r\n/),s=t.length,i=[];for(let e=0;e<s;e++){const s=t[e];this.lineNumber=e+1,this.lineLint(s,i)}return i}lineLint(e,t){return this.options.isInsertLineHeadSpace&&this.insertLineHeadSpace(e,t),this.options.isRemovePuncBeforeBrackets&&this.removeSpecificCharsBeforeChars(e,this.chars.rightBrackets,this.chars.puncs,t),this.options.isUnifyDoubleDash&&this.unifyDoubleChars(e,this.chars.dashs,t),this.options.isUnifyDoubleLeaders&&this.unifyDoubleChars(e,this.chars.leaders,t),this.options.isRemoveConsecPunc&&this.removeConsecSpecificChars(e,this.chars.puncs,!0,t),this.options.isRemoveExclamAfterPunc&&this.removeSpecificCharsAfterChars(e,this.chars.exclams,this.chars.puncs,t),this.options.isInsertSpaceAfterExclam&&this.insertStrToAfterSpecificChars(e,this.chars.exclams,"　",this.chars.rightBrackets.concat(this.chars.spaces,this.chars.puncs),!0,t),this.options.isRemoveConsecSpecificChars&&this.removeConsecSpecificChars(e,this.chars.forbidConsecChars,!1,t),[]}lineConvert(e){return 0!==this.chars.replaceMap.size&&(e=this.lineReplace(e)),this.options.isConvertArabicNum&&(e=this.convertArabicNum.convert(e)),this.options.isInsertLineHeadSpace&&(e=this.insertLineHeadSpace(e)),this.options.isRemovePuncBeforeBrackets&&(e=this.removeSpecificCharsBeforeChars(e,this.chars.rightBrackets,this.chars.puncs)),this.options.isUnifyDoubleDash&&(e=this.unifyDoubleChars(e,this.chars.dashs)),this.options.isUnifyDoubleLeaders&&(e=this.unifyDoubleChars(e,this.chars.leaders)),this.options.isRemoveConsecPunc&&(e=this.removeConsecSpecificChars(e,this.chars.puncs,!0)),this.options.isRemoveExclamAfterPunc&&(e=this.removeSpecificCharsAfterChars(e,this.chars.exclams,this.chars.puncs)),this.options.isInsertSpaceAfterExclam&&(e=this.insertStrToAfterSpecificChars(e,this.chars.exclams,"　",this.chars.rightBrackets.concat(this.chars.spaces),!0)),this.options.isRemoveConsecSpecificChars&&(e=this.removeConsecSpecificChars(e,this.chars.forbidConsecChars,!1)),this.options.isRemoveTrailingSpaces&&(e=this.removeTrailingSpaces(e)),e}get jandentOptions(){return this.options}get targetChars(){return this.chars}get defaultJandentOptions(){return{isConvertArabicNum:!0,isInsertLineHeadSpace:!0,isRemovePuncBeforeBrackets:!0,isUnifyDoubleDash:!0,isUnifyDoubleLeaders:!0,isRemoveConsecPunc:!0,isRemoveExclamAfterPunc:!0,isInsertSpaceAfterExclam:!0,isRemoveTrailingSpaces:!0,isRemoveConsecSpecificChars:!0,isConvertHarfExclam:!0}}get defaultTargetChars(){return{replaceMap:new Map,forbidConsecChars:["を","ん","っ","ゃ","ゅ","ょ"],leftBrackets:["「","『","【","［","《","〈"],rightBrackets:["」","』","】","］","》","〉"],puncs:["、","。"],exclams:["！","？"],dashs:["―"],leaders:["…","‥"],spaces:[" ","　"],newline:"\n"}}get defaultJandentStates(){return{isLint:!1,lineNumber:1}}get isLint(){return this.states.isLint}get lineNumber(){return this.states.lineNumber}set lineNumber(e){this.states.lineNumber=e}get replaceMap(){return this.chars.replaceMap}isLintResult(e){return"lint"===e.type}isConvertResult(e){return"convert"===e.type}appendHarfExclamReplaceSetting(){this.chars.replaceMap.set("!","！"),this.chars.replaceMap.set("?","？")}removeHarfExclamReplaceSetting(){this.chars.replaceMap.delete("!"),this.chars.replaceMap.delete("?")}appendFullNumeralReplaceSetting(){const e=["0","1","2","3","4","5","6","7","8","9"],t=["０","１","２","３","４","５","６","７","８","９"];for(let s=0;s<10;s++)this.chars.replaceMap.set(t[s],e[s])}removeFullNumeralReplaceSetting(){const e=["０","１","２","３","４","５","６","７","８","９"];for(let t=0;t<10;t++)this.chars.replaceMap.delete(e[t])}getOptionsHandler(){const e=this;return{set:(t,s,i)=>("isConvertHarfExclam"===s&&i?e.appendHarfExclamReplaceSetting():"isConvertHarfExclam"===s&&e.removeHarfExclamReplaceSetting(),"isConvertArabicNum"===s&&i?e.appendFullNumeralReplaceSetting():"isConvertArabicNum"===s&&e.removeFullNumeralReplaceSetting(),Reflect.set(t,s,i))}}insertLineHeadSpace(e,t=null){const s=this.chars.spaces.join(""),i=this.chars.leftBrackets.join("");return new RegExp("^[^"+s+i+"]").test(e)&&(this.isLint&&null!==t&&t.push({line:this.lineNumber,columnBegin:0,columnEnd:1,detected:e.slice(0,1),kind:"MissingLineHeadSpace"}),e="　"+e),e}unifyDoubleChars(e,t,s=null){const i=t.join(""),r=new RegExp("["+i+"]+","g"),n=new RegExp("["+i+"]{2,}","g"),[c,a]=this.regexMatchAll(e,r,n),o=a.length;for(let t=0;t<o;t++){const i=a[t],r=c[t],n=i+t;e=e.slice(0,n)+r+e.slice(n),this.isLint&&null!==s&&s.push({line:this.lineNumber,columnBegin:i,columnEnd:i+1,detected:r,kind:"SingleUsedSpecificChar"})}return e}removeConsecSpecificChars(e,t,s,i=null){const r=t.join(""),n=s?new RegExp("["+r+"]{2,}","g"):new RegExp("(["+r+"])\\1+","g"),[c,a]=this.regexMatchAll(e,n),o=a.length;let h=0;for(let t=0;t<o;t++){const s=c[t],r=s.length,n=a[t],o=0===t?n:n-h;e=e.slice(0,o)+s.slice(0,1)+e.slice(o+r),h+=r-1,this.isLint&&null!==i&&i.push({line:this.lineNumber,columnBegin:n,columnEnd:n+r,detected:s,kind:"ConsecutiveSpecificChar"})}return e}removeSpecificCharsAfterChars(e,t,s,i=null){const r=t.join(""),n=s.join(""),c=new RegExp("(["+r+"]+)(["+n+"]+)","g");if(this.isLint&&null!==i){const[t,s]=this.regexMatchAll(e,c),r=s.length;for(let e=0;e<r;e++){const r=s[e],n=t[e],c=n.length;i.push({line:this.lineNumber,columnBegin:r,columnEnd:r+c,detected:n,kind:"SpecificCharAfterOtherSpecificChars"})}}return e.replace(c,"$1")}removeSpecificCharsBeforeChars(e,t,s,i=null){const r=t.join(""),n=s.join(""),c=new RegExp("(["+n+"]+)(["+r+"]+)","g");if(this.isLint&&null!==i){const[t,s]=this.regexMatchAll(e,c),r=s.length;for(let e=0;e<r;e++){const r=s[e],n=t[e],c=n.length;i.push({line:this.lineNumber,columnBegin:r,columnEnd:r+c,detected:n,kind:"SpecificCharBeforeOtherSpecificChars"})}}return e.replace(c,"$2")}insertStrToAfterSpecificChars(e,t,s,i=[],r=!1,n=null){const c=0===i.length,a=t.join(""),o=i.join(""),h=c&&r?"["+a+"]+.":"["+a+"]+",l=r?"(?!["+o+"]).":"(?!["+o+"])",p=c?new RegExp(h,"g"):new RegExp(h+l,"g"),[u,m]=this.regexMatchAll(e,p),f=m.length,d=s.length;let g=e;for(let e=0;e<f;e++){const t=r?u[e].length-1:u[e].length,i=m[e],c=i+t+d*e;g=g.slice(0,c)+s+g.slice(c),this.isLint&&null!==n&&n.push({line:this.lineNumber,columnBegin:i,columnEnd:i+u[e].length,detected:u[e],kind:"SpecificCharAfterDisallowedChar"})}return g}removeTrailingSpaces(e){const t=this.chars.spaces.join("|"),s=new RegExp("(?:"+t+")+$");return s.test(e)&&(e=e.replace(s,"")),e}lineReplace(e){for(let[t,s]of this.chars.replaceMap)e=e.replace(t,s);return e}regexMatchAll(e,t,s){const i=[],r=[];let n;for(;n=t.exec(e);)void 0!==s&&s.test(n[0])||(r.push(n.index),i.push(n[0]));return[i,r]}}export{s as Jandent};
